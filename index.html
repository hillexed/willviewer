 <!DOCTYPE html>
<html>
<head>
  <title>Wills viewer</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
  <style type="text/css">
    .team_div {
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      height: 100%;
    }
    .team_container {
      padding: 10px;
    }
    body {
      background-color: lightblue;
    }
    @media only screen and (max-width: 600px) {
      body {
        font-size: 200%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <br>
    <h2>Team Wills Viewer</h2>
    <select id="teamSelector">
        <option value="none" id="defaultOption">Loading...</option>

    </select>
    <p>These stats are the total vote percentages so far across all votes on blaseball.com, as seen by an apple. Please keep in mind these stats may not reflect a team's intended goals, especially before Sunday. Many teams vote later in the week, meaning early votes will have a big effect on these numbers.</p>
    <p>Any talk of these percentages in the official blaseball discord must be spoilered. Because the elections are always a time of high tension, using this data to antagonize or speculate on player or team motives will not be tolerated. Don't forget, even a Will with a large vote share has a very real chance of not happening!
</p>
    <div class="row" id=wills></div>
    <small>Original <a href="https://faculty.sibr.dev/~dlareau/wills.html">here</a> by @DLareau on discord, upgraded by hillexed. </small>
  </div>
  

  <script type="text/javascript">
$.getJSON("https://api.sibr.dev/chronicler/v1/teams", function(team_data) {
    wills = {};
    teamContainers = {};

    function showATeam(teamName){
        for (var everyTeam in teamContainers) {
            teamContainers[everyTeam].hide();
        }

        if (teamName in teamContainers) {
            teamContainers[teamName].show();
        }

        if (teamName == "all") {
            for (var everyTeam in teamContainers) {
                teamContainers[everyTeam].show();
            }
        }
        location.hash = teamName;
    }

    $.getJSON("https://api.sibr.dev/proxy/database/offseasonSetup", function(season_data) {
        $.each(season_data.wills, function(idx, will) {
            wills[will.id] = will.title;
        });
    }).then(function() {
        let all = $('<option value="all">All</option>');
        $("#teamSelector").append(all);
        $("#teamSelector").on("change", function(event) {
            let teamName = event.target.value;
            showATeam(teamName);
        });

        Promise.all(
            $.map(team_data.data, function(team, idx) {
                return new Promise((resolve, reject) => {
                    if(team.data.stadium){
                        
                        $.getJSON("https://api.sibr.dev/proxy/database/teamElectionStats", {
                            'id': team.id
                        }, function(wills_data) {
                            team_container = $("<div id='" + team.data.nickname + "' class='team_container col-sm-10 col-md-6 col-lg-4 col-xl-3'></div>");
                            team_container.hide(); //hide by default 
                            team_div = $("<div class='team_div' id='" + team.id + "'></div>");
                            team_div.append("<h3 class='teamname'>" + team.data.nickname + "</h3>")
                            will_table = $("<table class='will_table table table-sm'></table>");
                            wills_data.wills.sort(function(a, b) {
                                return b.percent - a.percent;

                            });
                            for (var i = 0; i < wills_data.wills.length; i++) {
                                will_row = $("<tr class='reno_div'></tr>")
                                will_elem = $("<td data-toggle='tooltip'>" + wills_data.wills[i].percent + "% " + wills[wills_data.wills[i].id] + "</td>")
                                will_row.append(will_elem);
                                will_table.append(will_row);
                            }
                            team_div.append(will_table);
                            team_container.append(team_div);
                            teamContainers[team.data.nickname] = team_container;
                            resolve();
                        })
                    }else{
                        resolve();
                    }
                });
            })
        ).then(() => {
            //All loaded.
            $("#defaultOption").text("Choose a team");
            for (var teamName of Object.keys(teamContainers).sort()) {
                $("#wills").append(teamContainers[teamName]);

                team_selection_option = $("<option value='" + teamName + "'>" + teamName + "</option>");
                $("#teamSelector").append(team_selection_option);
            }
            let previouslyShownTeam = location.hash.slice(1);
            if(previouslyShownTeam in teamContainers || previouslyShownTeam == "#all"){
                showATeam(previouslyShownTeam);
            }
        })
    })
});

  </script>
</body>
</html>
